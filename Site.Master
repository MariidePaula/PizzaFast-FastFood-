<%-- Diretiva Master: Define esta p√°gina como um Master Page (Modelo). --%>
<%-- 'Language="C#"' define a linguagem de code-behind. --%>
<%-- 'CodeBehind' aponta para o arquivo de c√≥digo C# (Site.Master.cs). --%>
<%-- 'Inherits' define a classe C# que herda as propriedades desta p√°gina. --%>
<%@ Master Language="C#" AutoEventWireup="true" CodeBehind="Site.Master.cs" Inherits="FastPizza.SiteMaster" %>

<!DOCTYPE html>

<%-- Define o idioma da p√°gina como Portugu√™s do Brasil. --%>
<html lang="pt-BR">
<head runat="server">
    <%-- Define a codifica√ß√£o de caracteres como UTF-8. --%>
    <meta charset="utf-8" />
    <%-- Configura√ß√£o para responsividade (visualiza√ß√£o em dispositivos m√≥veis). --%>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <%-- Define o t√≠tulo da p√°gina. O <%: Page.Title %> insere o t√≠tulo da p√°gina de conte√∫do. --%>
    <title><%: Page.Title %> - Fast Pizza</title>
    
    <%-- Inclus√£o do CSS do Bootstrap 5 para estilos responsivos. --%>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" /> 
    <%-- Inclus√£o do Font Awesome para √≠cones. --%>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <%-- Inclus√£o da fonte 'Poppins' do Google Fonts. --%>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
    <%-- Defini√ß√£o de Favicon (√≠cone da aba do navegador) com um emoji de pizza üçï. --%>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüçï%3C/text%3E%3C/svg%3E" />
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüçï%3C</text>%3E%3C/svg%3E" />
    
    <%-- In√≠cio do bloco de estilos CSS customizados. --%>
    <style>
        /* Define a fonte Poppins e a cor de fundo clara para o corpo. */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FFFBF7; /* Fundo Creme/Claro */
        }
        /* Estilo para a marca/logo do navbar (tamanho, peso e cor de destaque). */
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: #E64A19 !important; /* Cor Laranja Escuro (destaque) */
            display: flex;
            align-items: center;
            gap: 8px;
        }
        /* Estilo para o √≠cone da pizza dentro da marca. */
        .navbar-brand i {
            font-size: 1.8rem;
        }
        /* Media Query para ajustar a marca em telas pequenas (smartphones). */
        @media (max-width: 576px) {
            .navbar-brand {
                font-size: 1.2rem;
            }
            .navbar-brand i {
                font-size: 1.4rem;
            }
            /* Ajusta a margem superior do conte√∫do principal em telas pequenas. */
            .main-content {
                margin-top: 70px;
            }
        }
        /* Estilos para a barra de navega√ß√£o (fixa, sombra, fundo). */
        .navbar {
            background-color: #FFFBF7 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 1px solid #e0e0e0;
            position: fixed; /* Barra de navega√ß√£o fixa no topo. */
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            width: 100%;
        }
        /* Limita a largura do container dentro do navbar. */
        .navbar .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            display: flex;
            align-items: center;
        }
        /* Limita a largura do container no conte√∫do principal. */
        .main-content .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        /* Estiliza o colapso do navbar para alinhar itens. */
        .navbar .navbar-collapse {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            flex-grow: 1;
        }
        /* Centraliza os links principais de navega√ß√£o horizontalmente (menu). */
        .navbar-nav.mx-auto {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            margin: 0 !important;
            white-space: nowrap;
        }
        /* Agrupa os √≠cones do lado direito do navbar (carrinho e usu√°rio). */
        .navbar-right-icons {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }
        /* Impede que a marca diminua. */
        .navbar-brand {
            flex-shrink: 0;
        }
        /* Media Query para telas m√©dias/pequenas (tablet/mobile) para o menu colapsado. */
        @media (max-width: 991px) {
            /* Altera a dire√ß√£o para coluna e estica o alinhamento. */
            .navbar .navbar-collapse {
                flex-direction: column;
                align-items: stretch;
            }
            /* Desfaz a centraliza√ß√£o absoluta do menu no mobile/tablet. */
            .navbar-nav.mx-auto {
                position: static;
                transform: none;
                text-align: center;
                margin: 10px 0 !important;
                justify-content: center;
            }
            /* Centraliza os √≠cones da direita no mobile/tablet. */
            .navbar-right-icons {
                margin-left: 0;
                justify-content: center;
                width: 100%;
                margin-top: 10px;
            }
        }
        /* Estilo padr√£o para os links de navega√ß√£o. */
        .nav-link {
            color: #333 !important;
            font-weight: 500;
            transition: color 0.3s;
            position: relative; 
            display: inline-block;
        }
        /* Efeito hover: muda a cor do link para o destaque. */
        .nav-link:hover {
            color: #E64A19 !important;
        }
        
        /* Estilos para os itens de dropdown (Menu de Usu√°rio/Admin). */
        .dropdown-item {
            transition: all 0.2s ease;
        }
        
        /* Cor de fundo e texto ao passar o mouse ou selecionar um item do dropdown. */
        .dropdown-item:hover,
        .dropdown-item:focus,
        .dropdown-item.active,
        .dropdown-item:active {
            background-color: #E64A19 !important;
            color: white !important;
        }
        
        /* Mant√©m a cor do √≠cone branca nos estados hover/active. */
        .dropdown-item:hover i,
        .dropdown-item:focus i,
        .dropdown-item.active i,
        .dropdown-item:active i {
            color: white !important;
        }
        
        /* Mant√©m o estilo para cliques no dropdown. */
        .dropdown-item:not(:disabled):not(.disabled):active,
        .dropdown-item:not(:disabled):not(.disabled).active {
            background-color: #E64A19 !important;
            color: white !important;
        }
        
        /* Estilos de foco para campos de sele√ß√£o (select) para usar a cor de destaque. */
        select.form-control:focus,
        select:focus {
            border-color: #E64A19;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(230, 74, 25, 0.25);
        }
        
        /* Estilos para op√ß√µes do select (tentativa de contornar problemas de estilo nativo). */
        select option {
            background-color: white !important;
            color: #333 !important;
        }
        
        select option:hover,
        select option:focus,
        select option:active {
            background: #E64A19 !important;
            background-color: #E64A19 !important;
            color: white !important;
        }
        
        select option:checked {
            background-color: white !important;
            color: #333 !important;
        }
        
        select.form-control option {
            padding: 8px;
        }
        
        /* Estilo do conte√∫do principal: altura m√≠nima, padding e margem superior para compensar o navbar fixo. */
        .main-content {
            min-height: calc(100vh - 200px); /* Garante que o footer fique na parte inferior em telas pequenas. */
            padding: 20px 0;
            margin-top: 76px; /* Ajusta a margem superior devido ao navbar fixo. */
        }
        
        /* Estilo para o container de toasts (mensagens de feedback), fixo no topo e √† direita. */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        /* Ajuste do toast-container e toasts para telas pequenas. */
        @media (max-width: 768px) {
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px; /* Expande para toda a largura em mobile. */
            }
            .toast {
                width: 100% !important;
                max-width: 100% !important;
            }
        }

        /* Estilo para o badge de quantidade de itens no √≠cone do carrinho. */
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -8px;
            background-color: #E64A19; /* Cor de destaque (Laranja Escuro) */
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid #FFFBF7; /* Borda da cor de fundo para destaque. */
            min-width: 18px;
            text-align: center;
        }
    </style>

    <%-- Placeholder para conte√∫do espec√≠fico do <head> de cada p√°gina. --%>
    <asp:ContentPlaceHolder ID="HeadContent" runat="server">
    </asp:ContentPlaceHolder>
    
</head>
<body>
    <%-- O formul√°rio principal do ASP.NET Web Forms (obrigat√≥rio). --%>
    <form id="form1" runat="server">
        <%-- Gerenciador de Scripts para habilitar funcionalidades AJAX/UpdatePanels. --%>
        <asp:ScriptManager runat="server">
        </asp:ScriptManager>
        
        <%-- In√≠cio da Barra de Navega√ß√£o (Navbar) com Bootstrap. --%>
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <%-- Link da Marca/Logo. 'ResolveUrl' garante o caminho correto para o Default.aspx. --%>
                <a class="navbar-brand" href="<%= ResolveUrl("~/Default.aspx") %>">
                    <i class="fa-solid fa-pizza-slice"></i> PizzaExpress
                </a>
                
                <%-- Bot√£o Hamburger para dispositivos m√≥veis (Bootstrap Toggler). --%>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <%-- Conte√∫do colaps√°vel do Navbar. --%>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <%-- Lista de links principais (centralizada). --%>
                    <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="<%= ResolveUrl("~/Default.aspx") %>">In√≠cio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="<%= ResolveUrl("~/Cardapio.aspx") %>">Card√°pio</a>
                        </li>
                        <%-- Link Condicional (Meus Pedidos/Dashboard Admin). --%>
                        <li class="nav-item">
                            <%-- Panel para o link 'Meus Pedidos' (vis√≠vel por padr√£o, controlado pelo code-behind). --%>
                            <asp:Panel ID="pnlLinkMeusPedidos" runat="server">
                                <a class="nav-link" href="<%= ResolveUrl("~/MeusPedidos.aspx") %>">Meus Pedidos</a>
                            </asp:Panel>
                            <%-- Panel para o link 'Dashboard Admin' (invis√≠vel por padr√£o, controlado pelo code-behind). --%>
                            <asp:Panel ID="pnlLinkDashboardAdmin" runat="server" Visible="false">
                                <a class="nav-link" href="<%= ResolveUrl("~/Admin/Dashboard.aspx") %>">
                                    <i class="fa-solid fa-pizza-slice"></i> Dashboard
                                </a>
                            </asp:Panel>
                        </li>
                    </ul>
                    
                    <%-- √çcones da direita: Carrinho e Usu√°rio/Login. --%>
                    <div class="navbar-right-icons">
                        <%-- UpdatePanel para atualizar o √≠cone do carrinho via AJAX (sem recarregar a p√°gina). --%>
                        <asp:UpdatePanel ID="upCarrinho" runat="server" UpdateMode="Conditional">
                            <ContentTemplate>
                                <%-- Link para o Carrinho. --%>
                                <a class="nav-link" href="<%= ResolveUrl("~/Carrinho.aspx") %>" style="font-size: 1.1rem; position: relative;">
                                    <i class="fas fa-shopping-cart"></i>
                                    <%-- R√≥tulo para a quantidade de itens no carrinho (Badge). --%>
                                    <asp:Label ID="lblQtdCarrinho" runat="server" CssClass="cart-badge" Visible="false"></asp:Label>
                                </a>
                            </ContentTemplate>
                        </asp:UpdatePanel>

                        <%-- Panel para Usu√°rio Logado (exibe dropdown). --%>
                        <asp:Panel ID="pnlUsuarioLogado" runat="server" Visible="false">
                            <div class="dropdown">
                                <%-- Bot√£o do Dropdown (√≠cone de usu√°rio). --%>
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 1.1rem;">
                                    <i class="fas fa-user"></i>
                                </a>
                                <%-- Menu do Dropdown do Usu√°rio. --%>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item" href="<%= ResolveUrl("~/MeuPerfil.aspx") %>"><i class="fas fa-user-circle"></i> Meu Perfil</a></li>
                                    <li><a class="dropdown-item" href="<%= ResolveUrl("~/MeusPedidos.aspx") %>"><i class="fas fa-list"></i> Meus Pedidos</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <%-- Bot√£o de Logout (ASP:LinkButton executa evento no code-behind). --%>
                                    <li><asp:LinkButton ID="btnLogout" runat="server" CssClass="dropdown-item" OnClick="BtnLogout_Click"><i class="fas fa-sign-out-alt"></i> Sair</asp:LinkButton></li>
                                </ul>
                            </div>
                        </asp:Panel>
                        
                        <%-- Panel para Admin Logado (exibe dropdown, separado do usu√°rio). --%>
                        <asp:Panel ID="pnlAdminLogado" runat="server" Visible="false">
                            <div class="dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownAdmin" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 1.1rem;">
                                    <i class="fas fa-user"></i>
                                </a>
                                <%-- Menu do Dropdown do Admin. --%>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownAdmin">
                                    <li><a class="dropdown-item" href="<%= ResolveUrl("~/Admin/Clientes.aspx") %>"><i class="fas fa-users"></i> Clientes</a></li>
                                    <li><a class="dropdown-item" href="<%= ResolveUrl("~/Admin/Pedidos.aspx") %>"><i class="fas fa-list"></i> Pedidos</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <%-- Bot√£o de Logout para Admin. --%>
                                    <li><asp:LinkButton ID="btnLogoutAdmin" runat="server" CssClass="dropdown-item" OnClick="BtnLogoutAdmin_Click"><i class="fas fa-sign-out-alt"></i> Sair</asp:LinkButton></li>
                                </ul>
                            </div>
                        </asp:Panel>

                        <%-- Panel para Usu√°rio Deslogado (exibe apenas √≠cone de login). --%>
                        <asp:Panel ID="pnlUsuarioDeslogado" runat="server" Visible="false">
                            <a class="nav-link" href="<%= ResolveUrl("~/Login.aspx") %>" style="font-size: 1.1rem;">
                                <i class="fas fa-user"></i>
                            </a>
                        </asp:Panel>
                    </div>
                </div>
            </div>
        </nav>
        
        <%-- √Årea de Conte√∫do Principal (onde o conte√∫do das p√°ginas √© inserido). --%>
        <div class="main-content">
            <asp:ContentPlaceHolder ID="MainContent" runat="server">
            </asp:ContentPlaceHolder>
        </div>
        
        <%-- Rodap√© da p√°gina (Footer). --%>
        <footer class="bg-light text-center text-muted py-4 mt-5">
            <div class="container">
                <p class="mb-0">&copy; 2025 PizzaExpress. Todos os direitos reservados.</p>
            </div>
        </footer>
        
        <%-- Container para exibir Toasts (mensagens flutuantes). --%>
        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
        </div>

        <%-- Modal de Login (para ser exibido quando o usu√°rio tentar acessar recurso restrito). --%>
        <div class="modal fade" id="modalLogin" tabindex="-1" aria-labelledby="modalLoginLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLoginLabel">
                            <i class="fas fa-lock"></i> Fa√ßa Login para Continuar
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <%-- ASP:Labels e TextBoxes para o formul√°rio de login no Modal. --%>
                    <div class="modal-body">
                        <asp:Label ID="lblMensagemModal" runat="server" CssClass="alert alert-danger" Visible="false" style="display: block; margin-bottom: 20px;"></asp:Label>
                        
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Email:</label>
                            <asp:TextBox ID="txtEmailModal" runat="server" CssClass="form-control" placeholder="seu@email.com" TextMode="Email" />
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Senha:</label>
                            <asp:TextBox ID="txtSenhaModal" runat="server" CssClass="form-control" TextMode="Password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                        </div>
                        
                        <div class="text-center mb-3">
                            <p class="text-muted small">N√£o tem uma conta? <a href="<%= ResolveUrl("~/Cadastro.aspx") %>" class="text-danger fw-semibold">Cadastre-se aqui</a></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <%-- Bot√£o de Login do Modal. 'OnClick' chama evento no code-behind para processar o login. --%>
                        <asp:Button ID="btnLoginModal" runat="server" Text="Entrar" CssClass="btn btn-danger w-100" 
                            OnClick="btnLoginModal_Click" style="background-color: #E64A19; border: none; padding: 10px; font-weight: 600;" />
                    </div>
                </div>
            </div>
        </div>
        
        <%-- Inclus√£o do JavaScript do Bootstrap 5 (obrigat√≥rio para funcionalidades como Navbar Toggler e Modal). --%>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <%-- In√≠cio dos Scripts Customizados --%>
        
        <script>
            (function() {
                'use strict';
                
                // Vari√°vel global/local que indica se o usu√°rio/admin est√° logado (obtida da Session C#).
                window.usuarioLogado = <%= (Session["ClienteId"] != null || (Session["AdminLogado"] != null && (bool)Session["AdminLogado"])).ToString().ToLower() %>;
                var usuarioLogado = window.usuarioLogado;
                
                // Fun√ß√£o para exibir o Modal de Login.
                function mostrarModalLogin() {
                    var modalElement = document.getElementById('modalLogin');
                    if (modalElement) {
                        var modal = new bootstrap.Modal(modalElement);
                        modal.show();
                    }
                }
                
                // Verifica se a √°rea atual √© a √°rea de Admin.
                var isAdminArea = window.location.pathname.toLowerCase().indexOf('/admin/') !== -1;
                
                // Handler para eventos de clique em toda a p√°gina (captura de fase).
                var clickHandler = function(e) {
                    // Ignora a l√≥gica se estiver na √°rea de Admin.
                    if (isAdminArea) {
                        return;
                    }
                    
                    var usuarioLogadoAtual = window.usuarioLogado !== undefined ? window.usuarioLogado : usuarioLogado;
                    
                    // Se j√° estiver logado, n√£o faz nada.
                    if (usuarioLogadoAtual) {
                        return;
                    }
                    
                    var target = e.target;
                    var elemento = target;
                    
                    // Verifica se o elemento clicado √© um bot√£o/link de Admin (para ignorar a modal de login do cliente).
                    while (elemento && elemento !== document.body) {
                        if (elemento.getAttribute && elemento.getAttribute('data-admin-button') === 'true') {
                            return;
                        }
                        elemento = elemento.parentElement;
                    }
                    
                    elemento = target;
                    
                    // Loop para verificar se o clique √© em um elemento que requer login (ex: adicionar ao carrinho).
                    while (elemento && elemento !== document.body) {
                        var onclick = elemento.getAttribute('onclick') || '';
                        var href = elemento.getAttribute('href') || '';
                        var commandName = elemento.getAttribute('data-command-name') || '';
                        
                        // Verifica se √© um postback do ASP.NET.
                        var isPostbackButton = onclick.indexOf('__doPostBack') !== -1 || 
                                                     href.indexOf('__doPostBack') !== -1 ||
                                                     onclick.indexOf('javascript:__doPostBack') !== -1;
                        
                        var precisaLogin = false;
                        
                        // 1. Verifica atributo customizado 'data-require-login'.
                        if (elemento.getAttribute('data-require-login') === 'true') {
                            precisaLogin = true;
                        }
                        
                        // 2. Verifica 'CommandName' do ASP.NET (comum em bot√µes de ListViews/GridViews).
                        if (commandName === 'AdicionarCarrinho' || commandName.indexOf('Carrinho') !== -1) {
                            precisaLogin = true;
                        }
                        
                        // 3. Verifica o texto do bot√£o (heur√≠stica).
                        var texto = (elemento.textContent || elemento.innerText || '').toLowerCase();
                        if (texto.indexOf('finalizar') === -1 && texto.indexOf('pedido') === -1) {
                            if (texto.indexOf('adicionar') !== -1 && 
                                (texto.indexOf('carrinho') !== -1 || texto.indexOf('cart') !== -1)) {
                                precisaLogin = true;
                            }
                        }
                        
                        // Ignora bot√µes de 'Finalizar Pedido' (a l√≥gica de Finalizar Pedido geralmente lida com login no code-behind).
                        if (elemento.getAttribute('data-finalizar-pedido') === 'true' || 
                            elemento.id && elemento.id.indexOf('btnFinalizar') !== -1) {
                            return;
                        }
                        
                        // 4. Verifica classes (heur√≠stica).
                        var classes = (elemento.className || '').toLowerCase();
                        if (classes.indexOf('btn-add') !== -1 || 
                            classes.indexOf('adicionarcarrinho') !== -1 ||
                            classes.indexOf('add-to-cart') !== -1) {
                            precisaLogin = true;
                        }
                        
                        // 5. Verifica evento 'onclick' no elemento pai (√∫til para controles compostos).
                        var parentElement = elemento.parentElement;
                        while (parentElement && parentElement !== document.body) {
                            var parentOnclick = parentElement.getAttribute('onclick') || '';
                            if (parentOnclick.indexOf('AdicionarCarrinho') !== -1) {
                                precisaLogin = true;
                                break;
                            }
                            parentElement = parentElement.parentElement;
                        }
                        
                        // Se precisa de login E n√£o est√° logado E √© um bot√£o de postback (a√ß√£o de servidor):
                        if (precisaLogin && !usuarioLogadoAtual && isPostbackButton) {
                            // Impede a a√ß√£o padr√£o (o PostBack).
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                            // Mostra a modal de login.
                            mostrarModalLogin();
                            return false;
                        }
                        
                        elemento = elemento.parentElement;
                    }
                };
                
                // Adiciona o listener de clique em modo de captura (true) para ser executado antes dos handlers de clique normais.
                document.removeEventListener('click', clickHandler, true); // Remove antes para evitar duplicidade.
                document.addEventListener('click', clickHandler, true);
                
                // Handler para o evento de SUBMIT do formul√°rio (para capturar submits por ENTER ou bot√µes n√£o-postback).
                var form = document.getElementById('form1');
                if (form && !isAdminArea) {
                    var submitHandler = function(e) {
                        var usuarioLogadoAtual = window.usuarioLogado !== undefined ? window.usuarioLogado : usuarioLogado;
                        
                        if (usuarioLogadoAtual) {
                            return true;
                        }
                        
                        var submitButton = document.activeElement; // Captura o bot√£o que iniciou o submit.
                        if (submitButton) {
                            // Ignora se for o bot√£o de Finalizar Pedido.
                            if (submitButton.getAttribute('data-finalizar-pedido') === 'true' || 
                                (submitButton.id && submitButton.id.indexOf('btnFinalizar') !== -1) ||
                                (submitButton.value && submitButton.value.toLowerCase().indexOf('finalizar') !== -1)) {
                                return true;
                            }
                            
                            // Verifica se o bot√£o tem a l√≥gica de 'AdicionarCarrinho' e n√£o √© um bot√£o de finaliza√ß√£o.
                            var onclick = submitButton.getAttribute('onclick') || '';
                            if (onclick.indexOf('AdicionarCarrinho') !== -1) {
                                var texto = (submitButton.textContent || submitButton.innerText || submitButton.value || '').toLowerCase();
                                if (texto.indexOf('finalizar') === -1 && texto.indexOf('pedido') === -1) {
                                    if (texto.indexOf('adicionar') !== -1 && 
                                        (texto.indexOf('carrinho') !== -1 || texto.indexOf('cart') !== -1)) {
                                        e.preventDefault();
                                        e.stopPropagation();
                                        e.stopImmediatePropagation();
                                        mostrarModalLogin();
                                        return false;
                                    }
                                }
                            }
                        }
                        return true;
                    };
                    
                    // Adiciona o listener de submit.
                    form.removeEventListener('submit', submitHandler, true);
                    form.addEventListener('submit', submitHandler, true);
                }
            })();
        </script>
        
        <script>
            // Script para estilizar o foco/sele√ß√£o dos elementos <select> para usar a cor de destaque.
            document.addEventListener('DOMContentLoaded', function() {
                var selects = document.querySelectorAll('select.form-control, select');
                selects.forEach(function(select) {
                    select.addEventListener('focus', function() {
                        this.style.borderColor = '#E64A19';
                    });
                    select.addEventListener('blur', function() {
                        this.style.borderColor = '#ddd';
                    });
                    select.addEventListener('change', function() {
                        this.style.borderColor = '#E64A19';
                        // Adiciona um pequeno delay para a cor voltar ao normal ap√≥s a mudan√ßa.
                        setTimeout(function() {
                            select.style.borderColor = '#ddd';
                        }, 200);
                    });
                });
            });
        </script>
        
        <script>
            // Fun√ß√£o global para exibir mensagens de feedback (toasts) no canto superior direito.
            function mostrarFeedback(mensagem, tipo) {
                var toastContainer = document.querySelector('.toast-container');
                // Se o container n√£o existir, ele √© criado (redund√¢ncia de seguran√ßa).
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                    toastContainer.style.zIndex = '9999';
                    document.body.appendChild(toastContainer);
                }
                
                var toastId = 'toast-' + Date.now();
                var bgClass = tipo === 'success' ? 'bg-success' : 'bg-danger';
                var icon = tipo === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle';
                
                // Cria o HTML do Toast com Bootstrap e Font Awesome.
                var toastHtml = '<div id="' + toastId + '" class="toast align-items-center text-white ' + bgClass + ' border-0" role="alert" aria-live="assertive" aria-atomic="true">' +
                    '<div class="d-flex">' +
                    '<div class="toast-body">' +
                    '<i class="fas ' + icon + ' me-2"></i>' + mensagem +
                    '</div>' +
                    '<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>' +
                    '</div>' +
                    '</div>';
                
                // Insere o toast no container.
                toastContainer.insertAdjacentHTML('beforeend', toastHtml);
                
                // Inicializa e mostra o toast com JavaScript do Bootstrap.
                var toastElement = document.getElementById(toastId);
                var toast = new bootstrap.Toast(toastElement, {
                    autohide: true,
                    delay: 3000 // Tempo de exibi√ß√£o de 3 segundos.
                });
                toast.show();
                
                // Remove o elemento do DOM ap√≥s a anima√ß√£o de esconder.
                toastElement.addEventListener('hidden.bs.toast', function() {
                    toastElement.remove();
                });
            }
        </script>
        
        <script>
            // Script para aplicar a m√°scara de telefone (ex: (99) 99999-9999).
            function aplicarMascaraTelefone() {
                // Seleciona campos de texto ou tel cujo ID contenha 'txtTelefone'.
                var camposTelefone = document.querySelectorAll('input[type="text"][id*="txtTelefone"], input[type="tel"][id*="txtTelefone"]');
                
                camposTelefone.forEach(function(campo) {
                    campo.type = 'tel'; // Define o tipo para melhor usabilidade em mobile.
                    campo.setAttribute('inputmode', 'numeric');
                    campo.setAttribute('maxlength', '15'); // (99) 99999-9999 tem 15 caracteres.
                    
                    // L√≥gica principal de formata√ß√£o.
                    function formatarTelefone(valor) {
                        var numeros = valor.replace(/\D/g, ''); // Remove tudo que n√£o for d√≠gito.
                        
                        if (numeros.length > 11) { // Limita a 11 d√≠gitos (DD + 9 + 8 d√≠gitos).
                            numeros = numeros.substring(0, 11);
                        }
                        
                        if (numeros.length === 0) {
                            return '';
                        } else if (numeros.length <= 2) {
                            return '(' + numeros;
                        } else if (numeros.length <= 7) { // Fixo: (DD) XXXX-X
                            return '(' + numeros.substring(0, 2) + ') ' + numeros.substring(2);
                        } else { // Celular: (DD) 9XXXX-XXXX
                            return '(' + numeros.substring(0, 2) + ') ' + numeros.substring(2, 7) + '-' + numeros.substring(7);
                        }
                    }
                    
                    // Formata valor inicial (se houver).
                    if (campo.value) {
                        campo.value = formatarTelefone(campo.value);
                    }
                    
                    // Aplica a formata√ß√£o a cada digita√ß√£o.
                    campo.addEventListener('input', function(e) {
                        e.target.value = formatarTelefone(e.target.value);
                    });
                    
                    // Impede a digita√ß√£o de caracteres n√£o-num√©ricos.
                    campo.addEventListener('keypress', function(e) {
                        var char = String.fromCharCode(e.which);
                        if (!/[0-9]/.test(char)) {
                            e.preventDefault();
                        }
                    });
                    
                    // Trata colagem de texto (apenas n√∫meros s√£o mantidos e formatados).
                    campo.addEventListener('paste', function(e) {
                        e.preventDefault();
                        var texto = (e.clipboardData || window.clipboardData).getData('text');
                        var numeros = texto.replace(/\D/g, '');
                        if (numeros.length > 0) {
                            // Limpa e dispara input para reformatar.
                            campo.value = '';
                            campo.dispatchEvent(new Event('input'));
                            campo.value = numeros.substring(0, 11);
                            campo.dispatchEvent(new Event('input'));
                        }
                    });
                });
            }
            
            // Chama a fun√ß√£o ao carregar a p√°gina (DOMContentLoaded) e/ou se j√° estiver carregada.
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', aplicarMascaraTelefone);
            } else {
                aplicarMascaraTelefone();
            }
            
            // Garante que a m√°scara seja reaplicada ap√≥s eventos AJAX (UpdatePanel) do ASP.NET.
            if (typeof Sys !== 'undefined' && Sys.WebForms && Sys.WebForms.PageRequestManager) {
                Sys.WebForms.PageRequestManager.getInstance().add_endRequest(function() {
                    aplicarMascaraTelefone();
                });
            }
        </script>
        
        <script>
            // Script para garantir que campos de input de estoque/quantidade s√≥ aceitem n√∫meros inteiros n√£o-negativos.
            function aplicarValidacaoNumeroInteiro() {
                var todosCampos = document.querySelectorAll('input[type="number"]');
                // Filtra campos de n√∫mero cujo ID contenha 'estoque' ou 'quantidade' e n√£o tenham 'step' diferente de 1.
                var camposNumericos = Array.from(todosCampos).filter(function (campo) {
                    var step = campo.getAttribute('step');
                    var id = campo.id.toLowerCase();
                    return (id.indexOf('estoque') !== -1 || id.indexOf('quantidade') !== -1) &&
                        (step === null || step === '1' || step === '');
                });

                camposNumericos.forEach(function (campo) {
                    campo.setAttribute('min', '0'); // M√≠nimo de 0.
                    campo.setAttribute('step', '1'); // Passo de 1 (inteiro).
                    campo.setAttribute('inputmode', 'numeric');

                    // Garante que apenas n√∫meros inteiros fiquem no campo.
                    campo.addEventListener('input', function (e) {
                        var valor = e.target.value;

                        var numeros = valor.replace(/[^0-9]/g, ''); // Remove qualquer coisa que n√£o seja d√≠gito.

                        if (valor !== numeros) {
                            e.target.value = numeros;
                        }

                        // Garante que o valor n√£o seja negativo.
                        if (e.target.value < 0) {
                            e.target.value = '0';
                        }
                    });

                    // Impede a digita√ß√£o de caracteres n√£o-num√©ricos ou pontua√ß√µes (exceto teclas de controle).
                    campo.addEventListener('keypress', function (e) {
                        // Teclas permitidas: Backspace, Tab, Enter, Esc, Delete, Setas, Ctrl+A (selecionar tudo).
                        if (e.which === 8 || e.which === 9 || e.which === 13 || e.which === 27 ||
                            e.which === 46 || (e.which >= 35 && e.which <= 40) ||
                            (e.which === 65 && e.ctrlKey === true)) {
                            return;
                        }
                        // Bloqueia caracteres que n√£o s√£o de 0 a 9.
                        if (e.which < 48 || e.which > 57) {
                            e.preventDefault();
                        }
                    });

                    // Trata colagem de texto (apenas n√∫meros inteiros s√£o mantidos).
                    campo.addEventListener('paste', function (e) {
                        e.preventDefault();
                        var texto = (e.clipboardData || window.clipboardData).getData('text');
                        var numeros = texto.replace(/[^0-9]/g, '');
                        if (numeros.length > 0) {
                            campo.value = numeros;
                            campo.dispatchEvent(new Event('input'));
                        }
                    });

                    // Garante que o campo tenha '0' se ficar vazio ou inv√°lido ao perder o foco.
                    campo.addEventListener('blur', function (e) {
                        var valor = e.target.value;
                        if (valor === '' || valor === '-' || valor < 0) {
                            e.target.value = '0';
                        } else {
                            var numeros = valor.replace(/[^0-9]/g, '');
                            e.target.value = numeros || '0';
                        }
                    });
                });
            }

            // Chama a fun√ß√£o ao carregar a p√°gina e ap√≥s AJAX.
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', aplicarValidacaoNumeroInteiro);
            } else {
                aplicarValidacaoNumeroInteiro();
            }

            // Garante que a valida√ß√£o seja reaplicada ap√≥s eventos AJAX (UpdatePanel).
            if (typeof Sys !== 'undefined' && Sys.WebForms && Sys.WebForms.PageRequestManager) {
                Sys.WebForms.PageRequestManager.getInstance().add_endRequest(function () {
                    aplicarValidacaoNumeroInteiro();
                });
            }
        </script>
    </form>
</body>
</html>